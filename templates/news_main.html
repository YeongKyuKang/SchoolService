{% extends "base.html" %}

{% block title %}공지사항 메인 페이지{% endblock %}

{% block hero %}
<section class="hero">
    <h1>University Notices</h1>
    <p>Stay updated with the latest announcements from our university</p>
</section>
{% endblock %}

{% block extra_css %}
<style>
    .notice-grid-item h3 a {
        color: inherit;
        text-decoration: none;
    }
    .notice-grid-item h3 a:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentPage = 1;
        const noticesPerPage = 3;
        let allNotices = [];
    
        function loadNotices() {
            fetch('/notice/api/notices')
                .then(response => response.json())
                .then(notices => {
                    allNotices = notices;
                    displayNotices();
                    updatePaginationButtons();
                })
                .catch(error => {
                    console.error('Error fetching notices:', error);
                });
        }
    
        function displayNotices() {
            const startIndex = (currentPage - 1) * noticesPerPage;
            const endIndex = startIndex + noticesPerPage;
            const noticesToShow = allNotices.slice(startIndex, endIndex);
    
            const noticeGrid = document.getElementById('notice-list');
            noticeGrid.innerHTML = '';
    
            noticesToShow.forEach(notice => {
                const noticeElement = document.createElement('div');
                noticeElement.className = 'notice-item notice-grid-item';
                noticeElement.innerHTML = `
                    
                    <h3><a href="/notice/news/${notice.id}">${notice.title}</a></h3>
                    <p class="notice-content">${notice.content.substring(0, 100)}...</p>
                    <p class="notice-date">${new Date(notice.date).toLocaleDateString()}</p>
                `;
                noticeGrid.appendChild(noticeElement);
            });
    
            document.getElementById('currentPage').textContent = currentPage;
        }
    
        function updatePaginationButtons() {
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');
            const totalPages = Math.ceil(allNotices.length / noticesPerPage);
    
            prevButton.classList.toggle('disabled', currentPage === 1);
            nextButton.classList.toggle('disabled', currentPage === totalPages);
        }
    
        document.getElementById('prevPage').addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;
                displayNotices();
                updatePaginationButtons();
            }
        });
    
        document.getElementById('nextPage').addEventListener('click', (e) => {
            e.preventDefault();
            const totalPages = Math.ceil(allNotices.length / noticesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayNotices();
                updatePaginationButtons();
            }
        });
    
        loadNotices();
    });

</script>
<section class="notice-list">
    <h2 class="section-title">공지사항</h2>
    <div class="grid notice-grid" id="notice-list">
        {% for notice in notices %}
        <div class="notice-item notice-grid-item">
            <p class="notice-content">{{ notice.content|truncate(100) }}</p>
            <p class="notice-date">{{ notice.date.strftime('%Y-%m-%d') }}</p>
        </div>
        {% endfor %}
    </div>
    <div class="pagination">
        <a href="#" id="prevPage">&lt;</a>
        <span id="currentPage">1</span>
        <a href="#" id="nextPage">&gt;</a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
{% endblock %}

